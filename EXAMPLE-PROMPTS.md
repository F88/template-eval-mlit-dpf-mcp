# Task: MLIT Data Platform Research & Verification

あなたは MLIT Data Platform MCP Server の活用スペシャリストです。

以下の要件に従い、調査・分析タスクを自律的に遂行してください。

## タスクの目的

MCPサーバーのツール群を最大限に活用し、「調査内容」セクションに記載された調査を実行、結果を整理、分析すること。
本タスクを通じて、MCPサーバーが提供しているツール群の有効性を検証し、その利用プロセスと結果を詳細に記録すること。合わせて、LLMがMCPサーバーをどのように活用したか(ツール選択の判断、検索戦略、有効性)を使用実績として記録・分析すること。

## 調査内容

東京都中野区中央に存在する避難所に関する包括的なレポートを作成する。

## 出力要件

- 出力先ディレクトリ: 実行開始日時から生成した `yyyyMMdd-HHmmss` 形式のディレクトリを新規作成し、全ファイルをそこに出力する
- ファイル内の記述言語: **日本語**
- ファイル名: 英数字・ケバブケース (e.g., `analysis-report.md`)
- 使用モデルの記録: `LOG.md` の冒頭に、本タスクの実行に使用されたAIモデルの名称（例: `Claude Opus 4.6`, `GPT-4o` 等）を記録すること

## 実行プロセス

### 1. 対応計画の策定 (`PLAN.md`)

利用可能なMCPツール（`search`, `search_by_location_...`, `get_data` 等）を確認し、効率的なデータ取得・分析計画を策定してください。
分析の切り口（例：区ごとの数、災害種別ごとの対応可否など）もここで定義してください。

### 2. 計画の実行と検証ログの記録 (`LOG.md`)

計画に基づきツールを実行し、データを取得・分析する。

`LOG.md` の冒頭には以下のメタ情報を記載すること:

```markdown
# 実行ログ: (調査タイトル)

- 実行日時: YYYY-MM-DD HH:MM JST
- 使用モデル: (本タスクの実行に使用されたAIモデルの名称)
```

**ツールを1回実行するごとに**、以下のフォーマットで `LOG.md` に追記すること。まとめて後から書くのではなく、実行の都度記録する。

```markdown
### ステップ N: (実行内容の要約)

- **タイムスタンプ**: HH:MM～HH:MM (所要時間: X分)
- **目的**: 何を知りたくて実行したか
- **使用ツール**: ツール名と主要パラメータ
- **結果**: 実行結果の概要(成功/失敗、取得件数、主要なデータ項目など)
- **考察・次手**: 結果を受けてどう判断したか、次に何をするか
```

想定と異なる結果やエラーが発生した場合も、その事実と代替アプローチを記録すること。

#### 実行時間記録

全ステップ完了後、以下の形式で実行時間サマリーを記録すること:

```markdown
## 実行時間サマリー

| ステップ | 実行時刻 | 所要時間 |
|---------|--------|--------|
| Step 1 | 17:08～17:09 | 1分 |
| Step 2 | 17:09～17:10 | 1分 |
| ... | ... | ... |
| **計** | **17:08～17:XX** | **XX分** |
```

### 3. 分析レポートの作成

取得したデータを基に、PLAN.md で定義した成果物一覧に従って分析レポートを作成する。
各レポートには以下を含めること。

- データの出典（使用したデータセットID等）
- データから読み取れる傾向や洞察
- 必要に応じて表やリストによるデータの整理

### 4. LLM 統計情報の記録

全ステップ完了後、`LOG.md` に以下のLLM関連統計情報をセクションとして追加すること:

```markdown
## LLM 統計情報

### トークン消費

| 項目 | 数量 |
|-----|------|
| 入力トークン | XX,XXX |
| 出力トークン | XX,XXX |
| 合計トークン | XX,XXX |

### トークン消費内訳

| 処理段階 | トークン数 | 割合 |
|--------|---------|------|
| 計画策定 | X,XXX | X% |
| 検索・データ取得 | X,XXX | X% |
| 分析 | X,XXX | X% |
| レポート生成 | X,XXX | X% |
| **合計** | **XX,XXX** | **100%** |

### 処理効率指標

| 指標 | 数値 |
|-----|------|
| 処理行数/分 | X行/分 |
| 処理行数/トークン | X行/トークン |
| ステップあたり平均トークン | X,XXX トークン |
| API呼び出し数 | X回 |

### モデル性能統計

| 項目 | 数値 |
|-----|------|
| API呼び出し成功率 | X% (X/X) |
| データ取得成功率 | X% (XX/XX) |
| エラー発生数 | X件 |
| リトライ発生数 | X回 |
| 実行中断 | なし/あり |

### 出力品質メトリクス

| 項目 | 数値 |
|-----|------|
| 生成ファイル数 | X個 |
| 総行数 | X,XXX行 |
| 重複データ | X件 |
| エラー/不完全データ | X件 |
```

**記録のポイント**:

- トークン数はAPIレスポンスやシステムメトリクスから取得する
- 正確な数値が不明な場合は推定値として明記すること
- 処理効率指標は実際の実行時間と出力量から計算する

### 5. MCPサーバー使用実績の記録

全ステップ完了後、`LOG.md` に以下のMCPサーバー使用実績をセクションとして追加すること。
ステップ1～Nの実行記録を振り返り、使用したツールの情報を集計・整理する。

#### 5.1 使用ツール一覧

各ツールについて、呼び出し回数・カテゴリ・利用目的を一覧化する。

```markdown
## MCPサーバー使用実績

### 使用ツール一覧

| ツール名 | 呼び出し回数 | カテゴリ | 利用目的 |
|---------|------------|---------|--------|
| `normalize_codes` | X回 | ユーティリティ | (このツールを何のために使ったか) |
| `search` | X回 | 検索 | (このツールを何のために使ったか) |
| `search_by_location_rectangle` | X回 | 空間検索 | (このツールを何のために使ったか) |
| `get_data` | X回 | データ取得 | (このツールを何のために使ったか) |
| ... | ... | ... | ... |
| **合計** | **XX回** | **X種** | |
```

#### 5.2 ツール有効性の評価

各ツール(パラメータの組み合わせが異なる場合は別行とする)について、有効性を「高/中/低」で評価し、その理由を記録する。

```markdown
### ツール有効性の評価

| ツール名 | 有効性 | 評価理由 |
|---------|-------|--------|
| `normalize_codes` | 高 | (評価の理由) |
| `search` (phrase_match=false) | 低 | (評価の理由) |
| `search_by_location_rectangle` | 高 | (評価の理由) |
| ... | ... | ... |
```

#### 5.3 カテゴリ別集計

ツールをカテゴリ(ユーティリティ/検索系/データ取得系/カタログ参照 等)で分類し、それぞれの呼び出し回数と成功率を集計する。

```markdown
### カテゴリ別集計

| カテゴリ | ツール種数 | 呼び出し回数 | 成功率 |
|---------|----------|------------|-------|
| ユーティリティ | X種 | X回 | X% (X/X) |
| 検索系 | X種 | X回 | X% (X/X) |
| データ取得系 | X種 | X回 | X% (X/X) |
| **合計** | **X種** | **XX回** | **X% (X/X)** |
```

#### 5.4 検索戦略の知見

本調査を通じて得られた検索戦略に関する知見を箇条書きで記録する。以下のような観点を含めること:

- どのツール・パラメータの組み合わせが最も有効だったか
- キーワード検索と空間検索の使い分けに関する知見
- 期待通りに動作しなかったツールや検索条件とその理由
- 今後の類似調査で推奨される検索アプローチ

## アクション

上記のプロセスに従い、以下の順序で実行してください:

1. **PLAN.md** を策定する（調査方針と成果物定義）
2. **データ取得フェーズ** を実行しながら、タイムスタンプ付きで **LOG.md** に記録する
3. 各ステップ完了後、実行時刻と所要時間を記録する
4. **分析レポート** を作成する（PLAN.md に基づく）
5. **全ステップ完了後** に、以下をまとめて **LOG.md** に追加する:
   - 実行時間サマリー（各ステップの実行時刻と所要時間の一覧）
   - LLM統計情報（トークン消費、処理効率、モデル性能、出力品質）
6. **MCPサーバー使用実績** を `LOG.md` に追加する:
   - 使用ツール一覧（ツール名、呼び出し回数、カテゴリ、利用目的）
   - ツール有効性の評価（各ツールの有効性と評価理由）
   - カテゴリ別集計（ツール種数、呼び出し回数、成功率）
   - 検索戦略の知見（有効だった組み合わせ、使い分けの知見、推奨アプローチ）
